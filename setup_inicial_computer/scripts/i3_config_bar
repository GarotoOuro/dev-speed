#!/usr/bin/env dash

CONFIG_PATH="$HOME/.config/i3/config"

# Garante que o diretório ~/.config/i3 existe
mkdir -p "$(dirname "$CONFIG_PATH")"

# Se o arquivo existe, remove bloco antigo e quebras finais
if [ -f "$CONFIG_PATH" ]; then
    # Remove bloco `bar { ... }` se existir
    sed -i '/^bar[[:space:]]*{/,/^}/d' "$CONFIG_PATH"

    # Remove todas as linhas em branco no final do arquivo
    sed -i ':a;/^\n*$/{$d;N;ba}' "$CONFIG_PATH"
fi

# Insere novo bloco
cat <<EOF >> "$CONFIG_PATH"

bar {
    # Define o comando que gera as informações exibidas na barra
    status_command i3status

    # Define que a barra ficará no topo da tela (em vez de bottom, que é o padrão)
    position top

    # A barra ficará oculta por padrão e será exibida apenas sob demanda
    mode hide

    # A barra começa oculta ao iniciar o i3 (combinado com \`mode hide\`)
    hidden_state hide

    # Define que a barra aparecerá ao passar o mouse (sem pressionar nenhuma tecla)
    modifier none
}
EOF

# Verificação final
echo
echo "✅ Bloco da barra atualizado:"
grep -A 10 '^bar {' "$CONFIG_PATH"

